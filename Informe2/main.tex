
\documentclass{article}
%\usepackage{color}
%\usepackage[spanish]{babel}
\input{classicthesis-config}

\begin{document}
%\frenchspacing
%\raggedbottom
%\selectlanguage{spanish} % american ngerman
%\usepackage[spanish]{babel}
%\renewcommand*{\bibname}{new name}
%\setbibpreamble{}
%\pagenumbering{roman}
\pagestyle{plain}
%********************************************************************
% Frontmatter
%*******************************************************
%\title{iblah blah}
%\author{Blah blah }
%\date{August 2016}

%\maketitle
%\include{FrontBackmatter/DirtyTitlepage}
\begin{titlepage}
    %\pdfbookmark[1]{\myTitle}{titlepage}
    % if you want the titlepage to be centered, uncomment and fine-tune the line below (KOMA classes environment)
%    \begin{addmargin}[-1cm]{-3cm}
    \begin{center}
        \large

        \hfill

        \vfill

        \begingroup
            \color{CTtitle}\spacedallcaps{\myTitle} \\ \bigskip
        \endgroup

        \spacedlowsmallcaps{\mySubtitle}

        \vfill

%        \includegraphics[width=6cm]{gfx/TFZsuperellipse_bw} \\ \medskip

%        \mySubtitle \\ \medskip
        %\myDegree \\
        %\myDepartment \\
        %\myFaculty \\
        %\myUni \\ \bigskip

        \myTime

        \vfill

    \end{center}
%  \end{addmargin}
\end{titlepage}
%\include{FrontBackmatter/Titleback}
%\cleardoublepage\include{FrontBackmatter/Dedication}
%\cleardoublepage\include{FrontBackmatter/Foreword}
%\cleardoublepage\include{FrontBackmatter/Abstract}
%\cleardoublepage\include{FrontBackmatter/Publications}
%\cleardoublepage\include{FrontBackmatter/Acknowledgments}
%\cleardoublepage\include{FrontBackmatter/Contents}
%********************************************************************
% Mainmatter
%*******************************************************
%\cleardoublepage
%\pagestyle{scrheadings}
%\pagenumbering{arabic}
%\setcounter{page}{90}
% use \cleardoublepage here to avoid problems with pdfbookmark
%\cleardoublepage
%\part{Some Kind of Manual}\label{pt:manual}
%\include{Chapters/Chapter01}
%\cleardoublepage
%\ctparttext{You can put some informational part preamble text here.
%Illo principalmente su nos. Non message \emph{occidental} angloromanic
%da. Debitas effortio simplificate sia se, auxiliar summarios da que,
%se avantiate publicationes via. Pan in terra summarios, capital
%interlingua se que. Al via multo esser specimen, campo responder que
%da. Le usate medical addresses pro, europa origine sanctificate nos se.}
%\part{The Showcase}\label{pt:showcase}
%\include{Chapters/Chapter02}
%\addtocontents{toc}{\protect\clearpage} % <--- just debug stuff, ignore
%\include{Chapters/Chapter03}

% ********************************************************************
% Introduction
% ********************************************************************
%\newpage
%\section{Introducción}

%\input{content/subsection_00}


% ********************************************************************
% Data Analysis
% ********************************************************************
\newpage
\section{Estado actual}

\subsection{Árbol de decisión}

El método original intenta abarcar una serie de restricciones predefinidas en un archivo Excel siguiendo un orden parcialmente respetado. Si algún resultado o conjunto de resultados viola alguna de las lógicas, se envía un mensaje y se modifican ciertos campos específicos en la vista del analista.

Un problema con este método consiste en la violación de lógicas por parte de resultados superfluos o de poco interés, provocando que el analista destine tiempo a añadir una lógica “normal” personalizada para que dicha combinación se ignore en un futuro escenario. Así también, el proceso manual de incorporación de nuevas lógicas involucra un retardo de tiempo significativo ya que se debe hacer vía solicitud a un encargado externo.

Cada lógica contiene evaluaciones basadas en umbrales como los mostrados en la Tabla 1.

\begin{table}[!htbp]\centering
\begin{tabular}{|c|c|c|c|}
\hline 
Componente & Normal & Advertencia & Alarma \\ 
\hline 
Al & < 20 & 20-40 & > 40 \\ 
\hline 
Cr & < 10 & 10-20 & > 20 \\ 
\hline 
Cu & < 50 & 50-100 & > 100 \\ 
\hline 
Fe & < 200 & 200-300 & > 300 \\ 
\hline 
Si & < 15 & 15-25 & > 25 \\ 
\hline 
\end{tabular} \label{tab:limites}
\caption{Ejemplo de l\'ogicas en \'arbol de decisi\'on}
\end{table}


\subsection{Análisis Preliminar de la Estructura de los Datos}

El análisis de la información entregada por medio de la base de datos es enfocado principalmente en la extracción de la información relacionada a los ensayos de tribología realizados por la empresa a equipos de diferentes clientes. Las variables de interés observadas a partir de las múltiples tablas presentes en la base de datos, y que se considera ser\'an parte relevante de la alimentaci\'on de datos para el sistema de aprendizaje automático son las siguientes :
\newline \newline
Datos propios de cada muestra-ensayo :

\begin{itemize}
	\item \textbf{id\_cliente} : Valor único correspondiente al cliente que solicita la muestra.
	\item \textbf{id\_faena} : Valor único, propio de cada cliente, correspondiente a la faena desde donde proviene la muestra.
	\item \textbf{id\_tipo\_equipo} : Valor correspondiente al tipo de equipo desde donde proviene la muestra.
	\item \textbf{id\_tipo\_componente} : Valor correspondiente al tipo de componente desde donde proviene la muestra.
	\item \textbf{id\_componente} : Valor único, propio de cada cliente y faena, correspondiente al componente desde donde proviene la muestra.
	\item \textbf{correlativo\_muestra} : valor identificador de la muestra desde donde proviene el ensayo realizado.
	\item \textbf{id\_ensayo} : Valor identificador del ensayo realizado.
	\item \textbf{valor} : valor correspondiente al ensayo de la muestra analizada.
	\item \textbf{id\_protocolo} : Valor del protocolo usado para analisis del valor del ensayo determinado por el cliente.
	\item \textbf{m\_fecha\_muestreo\_annio} : Fecha de muestreo correspondiente al \textit{año}
	\item \textbf{m\_fecha\_muestreo\_mes} : Fecha de muestreo correspondiente al \textit{mes}
	\item \textbf{m\_fecha\_muestreo\_dia} : Fecha de muestreo correspondiente al \textit{día}
	\item \textbf{m\_fecha\_ingreso\_annio} : Fecha de ingreso de la muestra correspondiente al \textit{año}
	\item \textbf{m\_fecha\_ingreso\_mes} : Fecha de ingreso de la muestra correspondiente al \textit{mes}
	\item \textbf{m\_fecha\_ingreso\_dia} : Fecha de ingreso de la muestra correspondiente al \textit{día}
	
\end{itemize}
~\\
La Tabla 2 muestra el origen desde que tabla de la base de datos se obtiene el campo respectivo.

\begin{table}[!htbp]\centering
\begin{tabular}{|c|c|}
\hline 
Dato & Tabla (en BD original en MySQL) \\ 
\hline 
$id\_cliente$ & $trib\_precalculo\_reporte$ \\ 
\hline 
$id\_faena$ & $trib\_precalculo\_reporte$ \\ 
\hline 
$id\_tipo\_equipo$ & $trib\_precalculo\_reporte$ \\ 
\hline 
$id\_tipo_componente$ & $trib\_precalculo\_reporte$ \\ 
\hline 
$id\_componente$ & $trib\_muestra$ \\ 
\hline 
$correlativo\_muestra$ & $trib\_muestra$ \\ 
\hline 
$id\_ensayo$ & $trib\_resultado$ \\ 
\hline 
$valor$ & $trib\_resultado$ \\ 
\hline 
$id\_protocolo$ & $trib\_resultado$ \\ 
\hline 
\end{tabular} 
\caption{Relación entre datos y su origen en BD}
\end{table}

Datos propios de cada ensayo, obtenidos de la tabla \textit{trib\_ensayo} :

\begin{itemize}
	\item \textbf{id\_ensayo} : Identificador propio del ensayo realizado.
	\item \textbf{cp\_3\_tipo\_protocolo} : Tipo de ensayo al que corresponde (metal o lubricante).
	\item \textbf{nombre} : Nombre del ensayo.
\end{itemize}
~\\
Datos propios de cada protocolo, obtenidos de la tabla \textit{trib\_protocolo} :

\begin{itemize}
	\item \textbf{id\_protocolo} : Identificador propio del protocolo realizado.
	\item \textbf{nombre} : Nombre del protocolo.
\end{itemize}
~\\
Datos propios de cada ensayo con su protocolo determinado según el cliente, obtenidos de la tabla \textit{trib\_ensayo\_protocolo} :

\begin{itemize}
	\item \textbf{id\_protocolo} : Identificador del protocolo.
	\item \textbf{id\_ensayo} : Identificador del ensayo.
	\item \textbf{lim\_inf\_marginal} : Límite inferior marginal del ensayo correspondiente al protocolo.
	\item \textbf{lim\_sup\_marginal} : Límite superior marginal del ensayo correspondiente al protocolo.
	\item \textbf{lim\_inf\_condenatorio} : Límite inferior condenatorio del ensayo correspondiente al protocolo.
	\item \textbf{lim\_sup\_condenatorio} : Límite superior condenatorio del ensayo correspondiente al protocolo.
\end{itemize}

\subsection{Segmentación de Datos}

Con el objetivo de analizar los datos y relacionar resultados de ensayos se comienza segmentando los datos que son posibles de correlacionar.

La primera variable identificada para la segmentación de los resultados de los ensayos es \textit{id\_faena}, debido a que los valores obtenidos para cada ensayo dependen directamente de las condiciones de trabajo propias de cada faena. Debido a que la variable \textit{id\_faena} es única (no compartida entre clientes), se identifica que el valor de la variable \textit{id\_cliente} se vuelve solamente informativa y no relevante para la toma de decisiones en base a los datos.

Posterior a la primera segmentación es posible segmentar nuevamente los resultados por otras tres variables :

\begin{itemize}
	\item ``id\_tipo\_equipo''
	\item ``id\_tipo\_componente''
	\item ``id\_componente''
\end{itemize}

Al hacer un primer an\'alisis estad\'istico usando solo los datos provistos, se identifican los tipos de ensayo que presentan una mayor correlaci\'on entre s\'i, como se muestra en la Tabla \ref{tab:corr} donde se listan los 5 pares de correlaci\'on m\'as altos, y en la Figura \ref{fig:heatmap} donde se ilustra un mapa de calor donde la intensidad del color se asocia con la cercan\'ia a 1 y es directamente proporcional al grado de correlaci\'on, valor que naturalmente se observa m\'aximo en la diagonal.

\begin{table}[!htbp]
\begin{tabular}{|c|c|c|}
\hline 
Ensayo 1 & Ensayo 2 & Correlación (\%) \\ 
\hline 
pH & vanadium & 99.9965 \\ 
\hline 
chromium & pH & 99.9964 \\ 
\hline 
$acid\_total\_number$ & $basic\_total\_number$ & 98.8107 \\ 
\hline 
antifreeze & vanadium & 97.9971 \\ 
\hline 
$acid\_total\_number$ & $dilution\_by\_fuel$ & 97.9966 \\ 
\hline 
\end{tabular}
\caption{Mayor correlaci\'on entre ensayos para todos los clientes y componentes}
\label{tab:corr} 
\end{table}

\begin{figure}[!htbp]
\centering
\includegraphics[width=.85\textwidth]{figs/heatmap.pdf}
\caption{Mapa de calor con correlaci\'on de Pearson}
\label{fig:heatmap}
\end{figure}

Se destaca que si bien se observa una alta correlaci\'on entre distintos tipos de ensayos como los individualizados en la Tabla \ref{tab:corr}, esta relaci\'on no es necesariamente la misma para cada cliente, cuyo an\'alisis se compara para algunos clientes en las Figuras \ref{fig:perclient1} y \ref{fig:perclient2}.

\begin{figure}[!htbp]
\centering
\includegraphics[width=\textwidth]{figs/perclient1.pdf}
\vspace*{-30mm}
\caption{Correlaci\'on entre ensayos separados por cliente}
\label{fig:perclient1}
\end{figure}

\begin{figure}[!htbp]
\centering
\includegraphics[width=\textwidth]{figs/perclient2.pdf}
\vspace*{-30mm}
\caption{Correlaci\'on entre ensayos separados por cliente}
\label{fig:perclient2}
\end{figure}

En relaci\'on a la cantidad de datos disponibles, como se ilustra en el Histograma de la Figura \ref{fig:histogram}, un poco m\'as de 2500 (de un total de 3350) componentes presentes (como p.ej. U.Hidr\'aulica o Reductor) en la base de datos provista cuenta con menos de 200 datos disponibles. Adem\'as, considerando que para determinar el nivel de alerta asociado a una determinada muestra se aplican u omiten distintos ensayos, la cantidad de datos disponible para predecir el nivel de alerta en instantes futuros se prevee bajo la m\'inima. Sin embargo, es posible plantear el desaf\'io de aprendizaje para predecir el valor de ensayos aplicados a una muestra para un instante futuro, planificando comenzar con los resultados de ensayo asociado al fierro, cuyos registros hist\'oricos para los componentes almacenados se muestra en la Figura \ref{fig:fierro}.

\begin{figure}[!htbp]
\centering
\includegraphics[width=.75\textwidth]{figs/data_per_component_hist.pdf}
\caption{Cantidad de datos para distintos componentes}
\label{fig:histogram}
\end{figure}

\begin{figure}[!htbp]
\centering
\includegraphics[width=.75\textwidth]{figs/iron.pdf}
\caption{Evoluci\'on del fierro para ciertos componentes}
\label{fig:fierro}
\end{figure}

% ********************************************************************
% IA Approach
% ********************************************************************
\newpage
\section{Propuesta de Desarrollo de Inteligencia Artificial}

Con el propósito de entregar un resultado más completo al cliente que solicita el análisis de una muestra, es que se propone la incorporación de mecanismos de predicción de eventos futuros a partir del análisis de resultados acumulados de muestras históricas. 

Luego de observar los datos disponibles presentes en la base de datos de tribología entregados, es que se generan las siguientes propuestas de posibles enfoques en los que se puede centrar el problema de aprendizaje automático.

\subsection{Predicción de estados futuros para los an\'alisis de un componente}

Por medio del uso de los resultados históricos acumulados de las muestras de un componente analizado es posible estimar, a partir de una nueva muestra, posibles eventos y estados futuros de cierto an\'alisis a considerar para la posterior determinaci\'on de nivel de alerta (donde dicha \'ultima etapa no se contemplar\'a en el presente desarrollo de inteligencia artificial).

As\'i, por ejemplo considerando el componente \textit{Reductor} de la Figura \ref{fig:fierro}, a partir de las muestras disponibles ser\'ia posible predecir el resultado futuro de ese mismo tipo de ensayo para ese componente en el siguiente instante en que se recepcione una muestra, indicando si su valor seguir\'a estable como en las \'ultimas analizadas, o tendr\'a un valor alto como en las primeras muestras. Esto permitir\'ia evitar futuros problemas en los equipos, pudiendo anticipar medidas preventivas.


\subsubsection{Estimación de modificaciones no informadas de equipos o componentes}

Un problema que se observa en el proceso actual es la dificultad del análisis de los resultados de las muestras históricas de un componente, debido a la no entrega completa de información por parte del cliente que solicita el análisis de una muestra.

En la mayoría de los casos, no es compartida la información relacionada con cambios en el estado físico de los equipos, como lo son cambios de componentes y relleno o renovación de lubricantes, afectando la predicción de la propuesta anterior y el análisis de la nueva muestra.

De presentarse una estimación positiva en la modificación del estado físico de un componente, se incorporará en la información incompleta entregada por el cliente facilitando el análisis de la nueva muestra y permitirá predecir correctamente posibles eventos y estados futuros.
\\
El enriquecimiento de los resultados para las muestras, producto de las propuestas que han sido expuestas anteriormente, únicamente conllevan un análisis computacional con un costo adicional asociado mínimo pero de gran valor agregado al servicio ofrecido al cliente. El costo monetario adicional asociado dependerá de los requerimientos de hardware computacional involucrados en la predicción. 

Si los requerimientos para la predicción son posibles de solventar en máquinas computacionales locales, entonces no existirá costo adicional alguno. De no ser así, el costo del análisis se ve aumentado por los costos asociados al servicio AWS (Amazon Web Services) con características apropiadas para la predicción según el volumen de datos históricos en procesamiento.

\subsection{Observaciones}
Todo el código generado durante esta etapa se puede revisar en Github: \url{https://github.com/astng/module_ai} y en \url{https://github.com/astng/ai_data_analysis}. Al momento de la fecha de entrega de este documento, se ha replicado el mecanismo de toma de decisiones original en forma de restful API como servicio HTTP, cuya documentaci\'on de uso est\'a disponible en una Wiki en \url{https://github.com/astng/module_ai/wiki/Module-AI-API-Documentation}



% ********************************************************************
% Backmatter
%*******************************************************
%\newpage
%\appendix
%\section{Anexos}

%\input{content/subsection_A01}
%\renewcommand{\thechapter}{\alph{chapter}}
%\cleardoublepage
%\part{Appendix}
%\include{Chapters/Chapter0A}
%********************************************************************
% Other Stuff in the Back
%*******************************************************
%\cleardoublepage\include{FrontBackmatter/Bibliography}
%\cleardoublepage\include{FrontBackmatter/Declaration}
%\cleardoublepage\include{FrontBackmatter/Colophon}
\end{document}
